<?xml version="1.0" ?>
<project default="main">

    <property name="src" location="../src/main/java" />
    <property name="output" location="bin" />
    <property environment="env" />

    <target name="main" depends="init, compile, run">
        <echo>
            Building and running....
        </echo>
    </target>
  
    <target name="init">
        <delete dir="${output}" />
        <mkdir dir="${output}" />
    </target>
  
    <target name="compile">
        <javac srcdir="${src}" destdir="${output}" includeantruntime="false"/>
    </target>
  
    <target name="run" >
    	<!--  jdk 6 C:/Program Files/Java/jdk1.6.0_11/bin/java-->
    	<!--  jdk 5 C:/Program Files/java/jdk1.5.0_15/bin/java-->
        <java
        	classname="gengfo.jvm.memory.HelloWorldMem"
        	jvm="C:/Program Files/java/jdk1.5.0_15/bin/java" fork="true"
        	>
        	
            	<classpath>
               		<pathelement location="${output}"/>
            	</classpath>
            <!-- http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html#PerformanceTuning -->
            <!-- -agentlib:libname[=options] -->
            <jvmarg value="-Xms64m"/> 
            <jvmarg value="-Xmx64m"/> 
            
            <jvmarg value="-XX:PermSize=64m"/> 
            <!-- server MaxPermSize default 64m, client MaxPermSize default 32m -->	
            <jvmarg value="-XX:MaxPermSize=64m"/> 
            
            <!--
            <jvmarg value="-verbose:gc"/> 
            -->
            <!--
            <jvmarg value="-XX:+PrintGCDetails"/>
            -->
            
            <jvmarg value="-XX:+HeapDumpOnCtrlBreak"/>           
            <jvmarg value="-XX:HeapDumpPath=java_oom.hprof" />
             
	    <!--		                        
            <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
            <jvmarg value="-XX:HeapDumpPath=java_oom.hprof" />
            -->
            <!-- thread dump -->
            <!-- Ctrl+Break for Windows; kill -SIGQUIT <pid> for Unix;Java.lang.Thread.getAllStackTraces()-->
            <!-- -XX:-PrintClassHistogram -->
            
            <!-- heap dump -->
            <!--
            	http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6454676
            	There are many ways to trigger a heap dump on demand in jdk6. For example, jconsole or any JMX tool can trigger a heap dump
            	In older releases the only way to generate a heap dump is using the HPROF agent or using the jmap -heap:format=b option to recover a heap dump from a core file or process image. 
            	
            	Note, Java 6 does not have the HeapDumpOnCtrlBreak switch, you have to use the jmap tool to generate memory dumps.
            	
            -->
            
            <!-- Ctrl+Break with -XX:+HeapDumpOnCtrlBreak option-->
            <!-- -Xrunhprof -agentlib:hprof=heap=dump,format=b-->
            <!--Trigger with any JMX tool for JVM6.0 -->
            
            <!--
            <jvmarg value="-verbose:gc" />
            <jvmarg value="-XX:+PrintGCDetails" />
            
            <jvmarg value="-XX:+HeapDumpOnOutOfMemoryError" />
            <jvmarg value="-XX:HeapDumpPath=java_oom.hprof" />
            
            	-Xloggc:c:\gc.log / -verbose:gc 
		-XX:+PrintGCDetails -XX:+PrintGCTimeStamps 
		-XX:-HeapDumpOnOutOfMemoryError
		-XX:-PrintClassHistogram
            -->
            
        </java>
    </target>
	
</project>